const e=Object.prototype.hasOwnProperty,t={init(){this.plugins=[],this.settings={},this.mixins=[]},set(e,t){if(1===arguments.length)return this.settings[e];this.settings[e]=t},use(e,...t){return"function"==typeof e?this.plugins.push({handler:e,args:t}):"object"==typeof e&&this.mixins.push({handler:e,args:[]}),this},handle(e){this.plugins.forEach((t=>{if(t&&"function"==typeof t.handler){const n=t.handler.call(this,e,...t.args);"object"==typeof n&&this.mixins.push({handler:n,args:[]})}})),this.mixins.forEach((({handler:{onInit:t,onPause:n,build:i,onResume:s,onDestroy:o,onCreate:r,...l},args:a})=>{Object.assign(e,l)}))}};Buffer;let n=null;function i(){return l()&&o()}function s(){return l()&&r()}function o(){return"undefined"!=typeof hmApp}function r(){return"undefined"!=typeof __$$R$$__}function l(){return o()||r()}n="undefined"!=typeof __$$R$$__?__$$R$$__:()=>{},i()?hmApp.getPackageInfo:s()&&n("@zos/app").getPackageInfo,i()?hmUI:s()&&n("@zos/ui"),i()?hmSetting.getDeviceInfo:s()&&n("@zos/device").getDeviceInfo,i()?"undefined"!=typeof __$$app$$__&&__$$app$$__:s()&&n("@zos/i18n").getText,i()?hmApp.gotoPage:s()&&n("@zos/router").push,i()?hmBle:s()&&n("@zos/ble");let a=null;function h({state:e={},onInit:t,onResume:n,onPause:i,build:s,onDestroy:o,...r}={}){const l={state:e,...r,globalData:getApp()._options.globalData,onInit(...e){for(let t=0;t<=h.mixins.length-1;t++){const n=h.mixins[t];n.handler.onInit?.apply(this,e)}t?.apply(this,e)},onResume(...e){for(let t=0;t<=h.mixins.length-1;t++){const n=h.mixins[t];n.handler.onResume?.apply(this,e)}n?.apply(this,e)},onPause(...e){i?.apply(this,e);for(let t=h.mixins.length-1;t>=0;t--){const n=h.mixins[t];n.handler.onPause?.apply(this,e)}},build(...e){for(let t=0;t<=h.mixins.length-1;t++){const n=h.mixins[t];n.handler.build?.apply(this,e)}s?.apply(this,e)},onDestroy(...e){o?.apply(this,e);for(let t=h.mixins.length-1;t>=0;t--){const n=h.mixins[t];n.handler.onDestroy?.apply(this,e)}}};return h.handle(l),l}var g,u;i()?a=DeviceRuntimeCore.HmLogger:s()?a=n("@zos/utils").log:"undefined"!=typeof messaging&&"undefined"!=typeof Logger&&(a=Logger),g=h,u=t,Object.getOwnPropertyNames(u).forEach((function(t){if(!e.call(g,t)){var n=Object.getOwnPropertyDescriptor(u,t);Object.defineProperty(g,t,n)}})),h.init(),h.use((function(){return{onInit(){this.logger=a.getLogger(this.name||"Page"),this.log=(...e)=>{this.logger.log(...e)},this.error=(...e)=>{e[0]instanceof Error?this.logger.error(...e):this.logger.error({},...e)},this.debug=(...e)=>{this.logger.debug(...e)}},onCreate(){this.logger=a.getLogger(this.name||"app.js"),this.log=(...e)=>{this.logger.log(...e)},this.error=(...e)=>{e[0]instanceof Error?this.logger.error(...e):this.logger.error({},...e)},this.debug=(...e)=>{this.logger.debug(...e)}}}}));class f{constructor(e){this.global=e}getValue(e){return this.global[e]}setValue(e,t){return this.global[e]=t}deleteKey(e){delete this.global[e]}}class c extends f{constructor(){super(__$$app$$__.__globals__.__scopedGlobals__)}}function p(e,t={}){return this.messaging.request({method:"http.request",params:e},t)}const d=n("@zos/ble/TransferFile"),_=(m=d?new d:void 0,{canUseFileTransfer:()=>void 0!==m,onFile(e){return e&&this.canUseFileTransfer()?(m.inbox.on("newfile",(function(){const t=m.inbox.getNextFile();e&&e(t)})),this):this},onSideServiceFileFinished(e){return e&&this.canUseFileTransfer()?(m.inbox.on("file",(function(){const t=m.inbox.getNextFile();e&&e(t)})),this):this},emitFile(){return m.inbox.emit("file"),this},offFile(){return this.canUseFileTransfer()?(m.inbox.off("newfile"),m.inbox.off("file"),this):this},getFile(){return this.canUseFileTransfer()?m.inbox.getNextFile():null},sendFile(e,t){if(!this.canUseFileTransfer())throw new Error("fileTransfer is not available");return m.outbox.enqueueFile(e,t)}});var m;h.use((function(){(new c).getValue("_$mgr$_")[__$$module$$__.id]={}})).use((function(e){const t=function(){const{messaging:e}=getApp()._options.globalData;return e}();return{onInit(){this.messaging=this.state.messaging=t,this._onCall=this.onCall?.bind(this),this._onRequest=this.onRequest?.bind(this),this.messaging.onCall(this._onCall).onRequest(this._onRequest)},onDestroy(){this._onCall&&this.messaging.offOnCall(this._onCall),this._onRequest&&this.messaging.offOnRequest(this._onRequest)},request(e,t={}){return this.messaging.request(e,t)},call(e){return this.messaging.call(e)},httpRequest:p}})).use((function(e){return{onInit(){this._onReceivedFile=this.onReceivedFile?.bind(this),_.onFile(this._onReceivedFile)},onDestroy(){this._onReceivedFile&&_.offFile(this._onReceivedFile)},sendFile:(e,t)=>_.sendFile(e,t)}}));export{h as BasePage};
